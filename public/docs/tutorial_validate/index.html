<!doctype html> <html class=bc-primary lang=zh-cmn-Hans> <head> <meta charset=UTF-8> <title>Kickoff - 可能是东北三省最灵活易用的任务管理组件</title> <meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"> <meta name=renderer content=webkit> <meta http-equiv=X-UA-Compatible content="IE=Edge,chrome=1"> <meta name=apple-mobile-web-app-capable content=yes> <meta name=apple-mobile-web-app-status-bar-style content=black-translucent> <meta name=apple-mobile-web-app-title content=kickoff> <meta name=mobile-web-app-capable content=kickoff> <meta name=application-name content=kickoff> <meta content="telephone=no" name=format-detection> <meta name=msapplication-tap-highlight content=no> <meta name=author content=""> <meta name=keywords content=kickoff> <meta name=description content=kickoff> <link rel="shortcut icon" href="/kickoff/favicon.ico"> <script src="https://unpkg.com/turbolinks@5.2.0/dist/turbolinks.js"></script> <script src="/kickoff/assets/javascripts/browser_detect-145b9f2f.js" data-turbolinks-track=reload></script> <script src="https://unpkg.com/luda@0.3.3/dist/js/luda-degradation.min.js" data-turbolinks-track=reload></script> <link href="https://unpkg.com/luda@0.3.3/dist/css/luda-default.min.css" rel=stylesheet data-turbolinks-track=reload> <link href="/kickoff/assets/stylesheets/kickoff/kickoff.min-c70c4838.css" rel=stylesheet data-turbolinks-track=reload /> <link href="/kickoff/assets/stylesheets/site-0cffdc65.css" rel=stylesheet data-turbolinks-track=reload /> <script src="https://unpkg.com/luda@0.3.3/dist/js/luda.min.js" data-turbolinks-track=reload></script> <script src="/kickoff/assets/javascripts/kickoff/kickoff.min-13002b53.js" data-turbolinks-track=reload></script> <script src="/kickoff/assets/javascripts/site-e8cfef04.js" data-turbolinks-track=reload></script> </head> <body class="d-flex fd-column jc-between b-primary"> <header class="hollow-header sti-t zi-highest d-flex jc-between ai-center py-small px-large"> <a href="/kickoff/" class="hollow-header-logo py-tiny" data-turbolinks=false> <img src="/kickoff/assets/images/logo-ec45e657.svg" alt=logo class=d-block width=757 height=187 /> </a> <nav class="d-flex p7"> <a href="/kickoff/docs/general/" class="link-light px-small td-none">文档</a> <a href="https://codepen.io/collection/DgqZqO" class="link-light px-small td-none">示例</a> <a href="https://github.com/oatw/kickoff/blob/master/CHANGELOG.md" class="link-light px-small td-none">变更日志</a> <a href="https://github.com/oatw/kickoff" class="link-light px-small td-none">源码仓库</a> <a href="https://github.com/oatw/kickoff/raw/v0.2.5/release/kickoff-0.2.5.zip" class="btn btn-hollow-light btn-small px-small circle ml-small o-main">下载 v0.2.5</a> <a href="/kickoff/docs/general/" class="btn btn-light btn-small px-small c-primary circle ml-medium o-main">开始使用</a> </nav> </header> <main id=main class="rel zi-high"> <div id=doc class="d-flex jc-between min-h-100vh bc-light"> <aside id=doc-aside class="flex-ungrowable flex-unshrinkable"> <nav id=doc-nav class="of-auto p-large"> <div class=mb-small> <h2 class="h6 mb-small">开始</h2> <a href="/kickoff/docs/general/" class="p8 p-none td-none ">简介</a> <a href="/kickoff/docs/installation/" class="p8 p-none td-none ">安装</a> <a href="/kickoff/docs/browser_support/" class="p8 p-none td-none ">兼容性</a> </div> <div class=mb-small> <h2 class="h6 mb-small">教程</h2> <a href="/kickoff/docs/tutorial_introduction/" class="p8 p-none td-none ">入门</a> <a href="/kickoff/docs/tutorial_config/" class="p8 p-none td-none ">配置</a> <a href="/kickoff/docs/tutorial_event/" class="p8 p-none td-none ">事件</a> <a href="/kickoff/docs/tutorial_theming/" class="p8 p-none td-none ">主题</a> <a href="/kickoff/docs/tutorial_special_date/" class="p8 p-none td-none ">特殊日期</a> <a href="/kickoff/docs/tutorial_flag/" class="p8 p-none td-none ">时间线旗标</a> <a href="/kickoff/docs/tutorial_action_readonly/" class="p8 p-none td-none ">任务动作与只读属性</a> <a href="/kickoff/docs/tutorial_custom_action/" class="p8 p-none td-none ">自定义动作</a> <a href="/kickoff/docs/tutorial_custom_prop/" class="p8 p-none td-none ">自定义属性</a> <a href="/kickoff/docs/tutorial_validate/" class="p8 p-none td-none doc-nav-current-link">模型校验</a> <a href="/kickoff/docs/tutorial_render/" class="p8 p-none td-none ">自定义渲染</a> <a href="/kickoff/docs/tutorial_form/" class="p8 p-none td-none ">表单渲染</a> <a href="/kickoff/docs/tutorial_locale/" class="p8 p-none td-none ">多语言</a> </div> <div class=mb-small> <h2 class="h6 mb-small">API</h2> <a href="/kickoff/docs/api_kickoff/" class="p8 p-none td-none ">Kickoff</a> <a href="/kickoff/docs/api_task/" class="p8 p-none td-none ">Task</a> <a href="/kickoff/docs/api_time/" class="p8 p-none td-none ">Time</a> <a href="/kickoff/docs/api_timeline/" class="p8 p-none td-none ">Timeline</a> </div> </nav> </aside> <article id=doc-article class="article w-100 px-large pb-large"> <h1>模型校验</h1> <p>Kickoff中对Task实例的数据合法性校验分为两种，一种是比较简单的单一实例在产生数据更新后进行校验， 另一种是类似于数据库事务的多个实例产生更新后需要确保一致性和完整性的校验。 后者多发于任务具有关联关系时，单一任务周期变化对关联任务周期变化的影响。</p> <p>Kickoff使用事件机制来处理这两种情况下的数据合法性校验， 无论是单一任务模型校验还是事物型多任务模型校验，都可通过在<code>before-update</code>事件上添加监听来实现。 结合Task模型的<code>.error()</code>方法，还可以对任务表单进行精确的错误信息提示。</p> <p>下面我们通过一个例子来了解一下Kickoff中对Task实例数据对象进行校验及错误信息处理的方式。</p> <h2>开始实践</h2> <p>在下面的例子中，由于First Task是Second Task的f2s型前置任务， 因此，当First Task的结束时间更新为晚于Second Task的开始时间时，为了满足事务要求， Second Task的任务周期会自动进行调整。</p> <p>但是，我们在根任务<code>before-update</code>事件中添加了一个监听函数， 在这个函数中校验了任务的结束时间不能晚于2020-11-08 23:59:59， 如果晚于这个时间就向任务中添加错误信息并<code>alert</code>出来。所以情况究竟会如何呢？</p> <p>现在，你可以单独拖拽Second Task，或者拖拽First Task， 使得Second Task的结束时间晚于2020-11-08 23:59:59，看看会发生什么？</p> <p>再通过点击First Task的编辑按键或Second Task的编辑按键， 在弹出的表单中修改结束时间晚于2020-11-08 23:59:59，看看表单上的显示发生了什么变化？</p> <iframe height=600 style="width: 100%;" scrolling=no title="Kickoff Tutorial - Validating Task Data" src="https://codepen.io/Kickoff/embed/OJRQPBa?height=600&amp;theme-id=dark&amp;default-tab=result" frameborder=no loading=lazy allowtransparency=true allowfullscreen=true> See the Pen <a href="https://codepen.io/Kickoff/pen/OJRQPBa">Kickoff Tutorial - Validating Task Data</a> by Kickoff (<a href="https://codepen.io/Kickoff">@Kickoff</a>) on <a href="https://codepen.io">CodePen</a>. </iframe> <p>对于上面的示例，在分别对不同任务执行了更新结束时间的操作后，你能区分出什么情况下执行的是单一模型校验， 什么情况下执行了事物型多模型校验吗？</p> <p>在理解了上面的问题后，我们来注意代码中的一个地方，在对任务实例添加错误消息的时候，我们向 <code>event.original.target</code> 的 <code>event.original.prop</code>添加了错误消息， 这样做是因为对于一个事物型更新操作而言，引发更新的任务和属性与发生校验错误的任务和属性不一定是一样的。</p> <p><code>event.original.target</code> 和 <code>event.original.prop</code> 代表的是引起当前事务的任务和属性， 而<code>event.target</code>和<code>updated</code>中的属性是当前要被更新的任务和属性。对于这两个层面的区别要理解清楚。</p> <p>另外， <code>.error()</code>方法只控制UI视图错误信息的存储，并不对Task模型的更新动作产生影响， 这种机制类似于 <a href="/kickoff/docs/tutorial_action_readonly/">任务动作与只读属性</a> 中提到的任务<code>actions</code>和<code>readonlyProps</code>配置。</p> <p>最后需要说明的一点是，对于自定义属性的事物型更新，需要开发人员自行实现。</p> <p>关于Task事件和<code>.error()</code>方法的更多内容请查看 <a href="/kickoff/docs/api_task/">Task</a> API 事件部分。</p> </article> </div> </main> <footer class="rel zi-high px-large py-medium d-flex jc-between"> <p class="p7 mr-small c-light"> <span class=o-muted>Designed and built by</span> <a href="https://github.com/oatw" class="link-light fw-semibold">Oatw</a>, <span class=o-muted>Code licensed</span> <a href="https://github.com/oatw/kickoff/blob/master/LICENSE" class="link-light fw-semibold">MIT</a>. </p> <p class="p7 c-light"> <a href="https://github.com/oatw/kickoff/blob/master/CONTRIBUTING.md" class="link-light px-tiny td-none">Contributing</a> <span class=o-main>|</span> <a href="https://github.com/oatw/kickoff/issues/new?assignees=oatw&amp;labels=enhancement&amp;template=FEATURE_REQUEST.md" class="link-light px-tiny td-none">Feature Request</a> <span class=o-main>|</span> <a href="https://github.com/oatw/kickoff/issues/new?assignees=oatw&amp;labels=bug&amp;template=BUG_REPORT.md" class="link-light px-tiny td-none">Bug Report</a> </p> </footer> </body> </html>